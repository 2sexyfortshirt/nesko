<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ê–¥–º–∏–Ω ‚Äî –ú–µ–¥–∏–∞</title>
<style>
  :root{
    --bg:#040406;
    --panel:#0b0c0f;
    --muted:#9aa3b2;
    --accent:#00d4ff;
    --accent-2:#4c8cff;
    --danger:#ff4d4f;
    --card:#0f1113;
    --radius:12px;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: Inter, Roboto, Arial, sans-serif;
    background: linear-gradient(180deg,#030305 0%, #071018 100%);
    color:#e6eef6; -webkit-font-smoothing:antialiased; min-height:100vh;
  }

  /* layout */
  .app {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 30px;
    max-width:1200px; margin:28px auto; padding:24px;
  }

  /* sidebar */
  .sidebar {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius: var(--radius);
    padding:18px;
    height: calc(100vh - 96px);
    position:sticky; top:20px;
    box-shadow: 0 6px 24px rgba(2,6,23,0.6);
  }
  .brand { display:flex; gap:12px; align-items:center; margin-bottom:18px }
  .logo { width:44px; height:44px; border-radius:10px; background: linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; font-weight:700 }
  .brand h2{ margin:0; font-size:16px; letter-spacing:0.2px }
  .nav { margin-top:18px }
  .nav a{ display:block; color:var(--muted); text-decoration:none; padding:10px 8px; border-radius:8px; margin-bottom:6px }
  .nav a.active, .nav a:hover{ color:white; background: linear-gradient(90deg, rgba(0,212,255,0.06), rgba(76,140,255,0.03)); box-shadow: inset 0 0 0 1px rgba(76,140,255,0.04) }

  /* main */
  .main { }
  .top {
    display:flex; justify-content:space-between; align-items:center; margin-bottom:18px;
  }
  .top .title { font-size:20px; font-weight:600 }
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px; padding:18px; margin-bottom:18px; box-shadow: 0 6px 20px rgba(3,7,18,0.6);
  }

  /* form */
  .row { display:flex; gap:12px; flex-wrap:wrap }
  label { font-size:13px; color:var(--muted); display:block; margin-bottom:6px }
  input[type="text"], input[type="number"], select, input[type="file"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03);
    background:var(--card); color:#e9f2fb;
  }
  .two { flex:1 1 48% }
  .full { flex:1 1 100% }
  button.primary {
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#021627; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
  }
  button.danger {
    background:transparent;color:var(--danger); border:1px solid rgba(255,77,79,0.12); padding:8px 12px; border-radius:8px; cursor:pointer;
  }

  /* tables */
  table { width:100%; border-collapse:collapse; font-size:14px; margin-top:8px; table-layout:fixed; word-break:break-all; }
  th, td { text-align:left; padding:10px 8px; border-bottom:1px solid rgba(255,255,255,0.03) }
  th { color:var(--muted); font-size:13px; font-weight:600 }
  td small a{ color:var(--accent); word-break:break-word; font-size:12px; }

  /* responsive */
  @media (max-width:980px){
    .app{ grid-template-columns: 1fr; padding:12px }
    .sidebar{ position:relative; height:auto; }
  }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">N</div>
      <div>
        <h2>nesko admin</h2>
        <div style="font-size:12px; color:var(--muted)">—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–∑—ã–∫–æ–π –∏ –≤–∏–¥–µ–æ</div>
      </div>
    </div>

    <nav class="nav">
      <a class="active" href="#upload" onclick="showTab('upload')">‚ûï –ó–∞–≥—Ä—É–∑–∏—Ç—å</a>
      <a href="#audios" onclick="showTab('audios')">üéµ –ú—É–∑—ã–∫–∞</a>
      <a href="#videos" onclick="showTab('videos')">üé¨ –í–∏–¥–µ–æ</a>
      <a href="{{ url_for('logout') }}" style="margin-top:12px; color:var(--muted); display:block">–í—ã–π—Ç–∏</a>
    </nav>

    <div style="margin-top:18px; font-size:13px; color:var(--muted)">
      <div><strong>–ê–∫—Ü–µ–Ω—Ç:</strong> <span style="color:var(--accent)">electric blue</span></div>
      <div style="margin-top:8px">–§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ DO Spaces. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ‚Äî –≤ JSON.</div>
    </div>
  </aside>

  <main class="main">
    <div class="top">
      <div class="title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –ú–µ–¥–∏–∞</div>
      <div style="color:var(--muted); font-size:13px">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ <strong>{{ ADMIN_USER }}</strong></div>
    </div>

    <!-- UPLOAD -->
    <section id="upload" class="card">
      <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h3>
      <form action="{{ url_for('admin') }}" method="post" enctype="multipart/form-data" id="upload-form">
        <div class="row">
          <div class="two">
            <label>–¢–∏–ø –º–µ–¥–∏–∞</label>
            <select name="media_type" id="media_type">
              <option value="audio">–ú—É–∑—ã–∫–∞ (–ø—Ä–æ–¥–∞—ë—Ç—Å—è)</option>
              <option value="video">–í–∏–¥–µ–æ (–ø—Ä–æ–º–æ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ)</option>
            </select>
          </div>
          <div class="two">
            <label>–§–∞–π–ª</label>
            <input type="file" name="file" accept="audio/*,video/*" required />
          </div>
          <div class="two" id="artist_wrap">
            <label>–ê—Ä—Ç–∏—Å—Ç</label>
            <input type="text" name="artist" placeholder="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å (–¥–ª—è –º—É–∑—ã–∫–∏)" />
          </div>
          <div class="two" id="genre_wrap">
            <label>–ñ–∞–Ω—Ä</label>
            <input type="text" name="genre" placeholder="–ñ–∞–Ω—Ä (–¥–ª—è –º—É–∑—ã–∫–∏)" />
          </div>
          <div class="two" id="price_wrap">
            <label>–¶–µ–Ω–∞ (‚Ç∫)</label>
            <input type="number" step="0.01" name="price" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 3.99" />
          </div>
          <div class="two" id="thumb_wrap">
          <label>–û–±–ª–æ–∂–∫–∞ (jpg/png)</label>
          <input type="file" name="thumb" accept="image/*" />
          </div>

          <div class="two" id="title_wrap" style="display:none">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ</label>
            <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–¥–ª—è –≤–∏–¥–µ–æ)" />
          </div>
        </div>
        <div style="margin-top:12px">
          <button class="primary" type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
      </form>
    </section>

    <!-- AUDIOS -->
    <section id="audios" class="card" style="display:none">
      <h3>üéµ –ú—É–∑—ã–∫–∞</h3>
      <table>
        <thead><tr><th>–§–∞–π–ª</th><th>–ê—Ä—Ç–∏—Å—Ç</th><th>–ñ–∞–Ω—Ä</th><th>–¶–µ–Ω–∞</th><th></th></tr></thead>
        <tbody>
        {% for c in covers %}
          <tr>
            <td>{{ c.filename }}<br><small><a href="{{ c.url }}" target="_blank">{{ c.url|replace('https://','') }}</a></small></td>
            <td>{{ c.artist }}</td>
            <td>{{ c.genre }}</td>
            <td>{{ (c.price / 100) if c.price is defined else 0 }} ‚Ç∫</td>
            <td>
              <form action="{{ url_for('delete_media', media_type='audio', filename=c.filename) }}" method="post" style="display:inline">
                <button class="danger">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5" style="color:var(--muted)">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </section>

    <!-- VIDEOS -->
    <section id="videos" class="card" style="display:none">
      <h3>üé¨ –í–∏–¥–µ–æ</h3>
      <table>
        <thead><tr><th>–§–∞–π–ª</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th></th></tr></thead>
        <tbody>
        {% for v in videos %}
          <tr>
            <td>{{ v.filename }}<br><small><a href="{{ v.url }}" target="_blank">{{ v.url|replace('https://','') }}</a></small></td>
            <td>{{ v.title }}</td>
            <td>
              <form action="{{ url_for('delete_media', media_type='video', filename=v.filename) }}" method="post" style="display:inline">
                <button class="danger">–£–¥–∞–ª–∏—Ç—å</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="3" style="color:var(--muted)">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </section>

  </main>
</div>

<script>
  function showTab(id){
    document.querySelectorAll('section.card').forEach(s=> s.style.display='none');
    document.getElementById(id).style.display = 'block';
    document.querySelectorAll('.nav a').forEach(a=> a.classList.remove('active'));
    document.querySelector('.nav a[href="#'+id+'"]').classList.add('active');
  }
  showTab('upload');

  const mediaSelect = document.getElementById('media_type');
  const titleWrap = document.getElementById('title_wrap');
  const artistWrap = document.getElementById('artist_wrap');
  const genreWrap = document.getElementById('genre_wrap');
  const priceWrap = document.getElementById('price_wrap');
const thumbWrap = document.getElementById('thumb_wrap');

function updateFields(){
    if(mediaSelect.value === 'audio'){
      titleWrap.style.display = 'none';
      artistWrap.style.display = 'block';
      genreWrap.style.display = 'block';
      priceWrap.style.display = 'block';
      thumbWrap.style.display = 'block';
    } else {
      titleWrap.style.display = 'block';
      artistWrap.style.display = 'none';
      genreWrap.style.display = 'none';
      priceWrap.style.display = 'none';
      thumbWrap.style.display = 'none';
    }
}
  mediaSelect.addEventListener('change', updateFields);
  updateFields();
</script>
</body>
</html>
