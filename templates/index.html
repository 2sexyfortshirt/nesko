


<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–µ–¥–∏–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
<style>
:root{
  --bg-1:#09030a; --bg-2:#120021; --accent-1:#c400ff; --accent-2:#00ffe7;
  --glass: rgba(255,255,255,0.06); --muted: rgba(255,255,255,0.65);
}
*{box-sizing:border-box}
html,body{margin:0;padding:32px;min-height:100%;font-family:'Poppins',sans-serif;color:#f4f4f6;background:linear-gradient(180deg,var(--bg-1),var(--bg-2))}
header{text-align:center;margin-bottom:28px}
h1{font-family:'Playfair Display', serif;font-size:48px;margin:0 0 8px;color:#fff}
.search input{padding:12px 16px;border-radius:12px;border:none;background:rgba(255,255,255,0.02);color:#fff;width:300px}
.search button{padding:12px 18px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent-1),#7a00ff);color:#fff;font-weight:700;cursor:pointer}

.category{margin-bottom:40px}
.category h2{color:#fff;font-size:24px;margin-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:4px}
.audio-list, .video-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
.card{background:var(--glass);border:1px solid rgba(255,255,255,0.04);border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:8px;backdrop-filter:blur(6px)}
.card img{width:100%;height:120px;object-fit:cover;border-radius:10px}
.card .artist{font-weight:600;font-size:16px}
.card .filename{font-size:14px;color:var(--muted)}
.card .genre{font-size:13px;color:#bff7ee;margin-top:4px;background:rgba(255,255,255,0.03);padding:4px 6px;border-radius:999px;display:inline-block}
.card button{padding:8px 12px;border:none;border-radius:10px;cursor:pointer;font-weight:600;color:#fff;margin-top:auto}
.play-btn{background:linear-gradient(135deg,var(--accent-1),#7a00ff)}
.buy-btn{background:linear-gradient(135deg,var(--accent-2),#0088ff)}
.video-card video{width:100%;border-radius:12px;display:block}

.particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.particles span{position:absolute;width:3px;height:3px;border-radius:50%;background:rgba(255,255,255,0.6);animation:twinkle infinite ease-in-out}
@keyframes twinkle{0%,100%{opacity:0.2}50%{opacity:1}}

.modal{position:fixed;top:0;left:0;width:100%;height:100%;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.6);z-index:2000}
.modal .panel{background:linear-gradient(180deg,#190021,#120014);padding:20px;border-radius:14px;color:#fff;min-width:300px;text-align:center;border:1px solid rgba(196,0,255,0.12)}
.modal .panel a.download{display:inline-block;margin-top:12px;padding:10px 16px;background:linear-gradient(135deg,#00ffe7,#00a0ff);color:#001018;border-radius:10px;font-weight:700}
/* ===== –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (—Ç—É—Ä–µ—Ü–∫–∏–π) ===== */
.legal-modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);display:none;justify-content:center;align-items:center;z-index:5000}
.legal-content{width:90%;max-width:720px;background:linear-gradient(180deg,#1b0022,#0c0013);border:1px solid rgba(255,255,255,0.12);border-radius:16px;padding:28px;color:#fff;max-height:80vh;overflow-y:auto}
.legal-content h2{margin-top:0;margin-bottom:14px}
.legal-close{margin-top:18px;background:#fff;color:#111;padding:10px 16px;border-radius:10px;border:none;font-weight:700;cursor:pointer}




footer{margin-top:60px;text-align:center;color:var(--muted);font-size:14px}
footer a{color:#fff;margin:0 10px;cursor:pointer;text-decoration:underline}
.country-selector {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.country-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: none;
  background: #222;
  color: white;
  cursor: pointer;
  border-radius: 6px;
}

.country-btn img {
  width: 24px;
  height: 18px;
  object-fit: cover;
}


.country-btn.active {
  background: #444;
  border-color: white;
}



</style>

</head>
<body>

<header>
  <h1>NEPIANO.NET</h1>
  <form class="search" method="get" action="/">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ query }}">
    <button type="submit">üîç</button>
  </form>
</header>

<div class="country-selector">
  {% for category in categories %}
    <button class="country-btn" data-target="{{ category.name|lower }}">
     <img src="https://flagcdn.com/24x18/{{ country_code[category.name]|lower }}.png">


      {{ category.name }}
    </button>
  {% endfor %}
</div>

<main>
  {% for category in categories %}
  <section class="category" data-country="{{ category.name|lower }}" style="display:none;">
    <h2>{{ category.name }}</h2>

{% if category.audios %}
<div class="audio-list">
  {% for a in category.audios %}
  <div class="card" data-filename="{{ a.filename }}">
    {% if a.thumb_url %}
    <img src="{{ a.thumb_url }}" alt="{{ a.filename }}">
    {% endif %}
    <div class="artist">{{ a.artist }}</div>
    <div class="filename">{{ a.filename }}</div>
    {% if a.genre %}
    <div class="genre">{{ a.genre }}</div>
    {% endif %}
    <audio src="{{ a.url }}" preload="metadata" class="audio-player"></audio>
    <button class="play-btn">‚ñ∂ Play</button>
    <button class="buy-btn" data-filename="{{ a.filename }}">
      üí≥ –ö—É–ø–∏—Ç—å ${{ (a.price/100)|round(2) }}
    </button>
  </div>
  {% endfor %}
</div>
{% endif %}

{% if category.videos %}
<div class="video-list" style="margin-top:20px;">
  {% for v in category.videos %}
  <div class="card video-card">
    <video src="{{ v.url }}" controls></video>
    <div class="filename">{{ v.filename }}</div>
    {% if v.title %}
    <div class="artist">{{ v.title }}</div>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% endif %}


  </section>
  {% endfor %}
</main>

<!-- –§—É—Ç–µ—Ä -->

<footer>
  <a onclick="openLegal('about')">Hakkƒ±mƒ±zda</a>
  <a onclick="openLegal('delivery')">Teslimat ve ƒ∞ade</a>
  <a onclick="openLegal('privacy')">Gizlilik S√∂zle≈ümesi</a>
  <a onclick="openLegal('distance')">Mesafeli Satƒ±≈ü</a>

  <div style="margin-top: 18px; display: flex; justify-content: center; gap: 18px; align-items: center; opacity: 0.85;">
    <img src="{{ url_for('static', filename='logo_band_colored@1X.png') }}" alt="iyzico" style="height:28px;">
  </div>
</footer>

<!-- Legal Modals -->

{% for type, title, content in [('about','Hakkƒ±mƒ±zda','...'),('delivery','Teslimat ve ƒ∞ade','...'),('privacy','Gizlilik S√∂zle≈ümesi','...'),('distance','Mesafeli Satƒ±≈ü','...')] %}

<div id="legal-{{ type }}" class="legal-modal">
  <div class="legal-content">
    <h2>{{ title }}</h2>
    <p>{{ content }}</p>
    <button class="legal-close" onclick="closeLegal('{{ type }}')">Kapat</button>
  </div>
</div>
{% endfor %}

<div class="particles"></div>

<!-- Buy Modal -->

<div id="buy-modal" class="modal">
  <div class="panel">
    <div id="modal-message">‚úÖ –û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∞!</div>
    <a id="download-link" class="download" href="#">–°–∫–∞—á–∞—Ç—å</a>
    <div style="margin-top:14px">
      <button onclick="closeModal()" style="padding:8px 12px;border-radius:8px;border:none;background:#fff;color:#111;font-weight:700">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // --- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω ---
  const buttons = document.querySelectorAll(".country-btn");
  const categories = document.querySelectorAll(".category");

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      const country = btn.dataset.target;
      categories.forEach(cat => {
        cat.style.display = (cat.dataset.country === country) ? "block" : "none";
      });
    });
  });

  // --- –ß–∞—Å—Ç–∏—Ü—ã ---
  const particlesContainer = document.querySelector('.particles');
  for(let i=0;i<40;i++){
    const span = document.createElement('span');
    span.style.top = (Math.random()*100)+'%';
    span.style.left = (Math.random()*100)+'%';
    span.style.width = span.style.height = (2+Math.random()*3)+'px';
    span.style.animationDuration = (3+Math.random()*5)+'s';
    particlesContainer.appendChild(span);
  }

  // --- –ê—É–¥–∏–æ –ø–ª–µ–µ—Ä—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ---
  document.querySelectorAll('.card').forEach(card=>{
    const audio = card.querySelector('audio');
    const playBtn = card.querySelector('.play-btn');

    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
    const timeDisplay = document.createElement('div');
    timeDisplay.className = 'time-display';
    timeDisplay.textContent = '00:00 / 00:00';
    card.appendChild(timeDisplay);

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    audio.addEventListener('loadedmetadata', () => {
      const total = formatTime(audio.duration);
      timeDisplay.textContent = `00:00 / ${total}`;
    });

    audio.addEventListener('timeupdate', () => {
      const current = formatTime(audio.currentTime);
      const total = formatTime(audio.duration);
      timeDisplay.textContent = `${current} / ${total}`;
    });

    // Play/pause
    playBtn.addEventListener('click', () => {
      // –ü–∞—É–∑–∞ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞—É–¥–∏–æ
      document.querySelectorAll('audio').forEach(a=>{
        if(a !== audio){
          a.pause();
          const otherBtn = a.closest('.card').querySelector('.play-btn');
          if(otherBtn) otherBtn.textContent='‚ñ∂ Play';
        }
      });

      if(audio.paused){
        audio.play().catch(err=>console.log("Play error:", err));
        playBtn.textContent='‚è∏ Pause';
      } else {
        audio.pause();
        playBtn.textContent='‚ñ∂ Play';
      }
    });
  });

  function formatTime(sec){
    if(isNaN(sec)) return "00:00";
    const m = Math.floor(sec/60).toString().padStart(2,'0');
    const s = Math.floor(sec%60).toString().padStart(2,'0');
    return `${m}:${s}`;
  }

  // --- Buy modal ---
  document.querySelectorAll('.buy-btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const filename = btn.dataset.filename;
      document.getElementById('download-link').href = '/stream/' + filename;
      document.getElementById('buy-modal').style.display='flex';
    });
  });



}); // DOMContentLoaded

function closeModal(){ document.getElementById('buy-modal').style.display='none'; }
function openLegal(type){ document.getElementById('legal-'+type).style.display='flex'; }
function closeLegal(type){ document.getElementById('legal-'+type).style.display='none'; }
</script>

</body>
</html>

